<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using EntityManager | Berry ORM</title>
    <meta name="generator" content="VuePress 1.8.2">
    <meta name="description" content="Object Relational Mapping for front-ends">
    <link rel="preload" href="/berry-orm/assets/css/0.styles.69ca23ae.css" as="style"><link rel="preload" href="/berry-orm/assets/js/app.bfa13add.js" as="script"><link rel="preload" href="/berry-orm/assets/js/2.e602c081.js" as="script"><link rel="preload" href="/berry-orm/assets/js/12.82d3c7ed.js" as="script"><link rel="prefetch" href="/berry-orm/assets/js/10.99d67eff.js"><link rel="prefetch" href="/berry-orm/assets/js/11.2c42b4e5.js"><link rel="prefetch" href="/berry-orm/assets/js/13.4e42097e.js"><link rel="prefetch" href="/berry-orm/assets/js/14.849b402d.js"><link rel="prefetch" href="/berry-orm/assets/js/15.b70dc088.js"><link rel="prefetch" href="/berry-orm/assets/js/16.67d91825.js"><link rel="prefetch" href="/berry-orm/assets/js/17.a0ab189b.js"><link rel="prefetch" href="/berry-orm/assets/js/18.9b4e1bf5.js"><link rel="prefetch" href="/berry-orm/assets/js/19.d3ed5caa.js"><link rel="prefetch" href="/berry-orm/assets/js/20.daf4a656.js"><link rel="prefetch" href="/berry-orm/assets/js/21.0db1f93b.js"><link rel="prefetch" href="/berry-orm/assets/js/22.0129036c.js"><link rel="prefetch" href="/berry-orm/assets/js/3.8580fdcc.js"><link rel="prefetch" href="/berry-orm/assets/js/4.8c15e02b.js"><link rel="prefetch" href="/berry-orm/assets/js/5.d250c593.js"><link rel="prefetch" href="/berry-orm/assets/js/6.740329d2.js"><link rel="prefetch" href="/berry-orm/assets/js/7.7867ee0d.js"><link rel="prefetch" href="/berry-orm/assets/js/8.778f548f.js"><link rel="prefetch" href="/berry-orm/assets/js/9.8e265b82.js">
    <link rel="stylesheet" href="/berry-orm/assets/css/0.styles.69ca23ae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/berry-orm/en/" class="home-link router-link-active"><!----> <span class="site-name">Berry ORM</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/berry-orm/en/guide/using-entity-manager.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/berry-orm/zh/guide/using-entity-manager.html" class="nav-link">
  zh-CN
</a></li></ul></div></div> <a href="https://github.com/TheNightmareX/berry-orm" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/berry-orm/en/guide/using-entity-manager.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/berry-orm/zh/guide/using-entity-manager.html" class="nav-link">
  zh-CN
</a></li></ul></div></div> <a href="https://github.com/TheNightmareX/berry-orm" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/berry-orm/en/guide/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/berry-orm/en/guide/defining-entities.html" class="sidebar-link">Defining Entities</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/defining-entities.html#defining-entity-classes" class="sidebar-link">Defining Entity Classes</a></li><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/defining-entities.html#defining-entity-fields" class="sidebar-link">Defining Entity Fields</a></li><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/defining-entities.html#accessors-and-methods" class="sidebar-link">Accessors and Methods</a></li><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/defining-entities.html#example" class="sidebar-link">Example</a></li></ul></li><li><a href="/berry-orm/en/guide/constructing-orm.html" class="sidebar-link">Constructing BerryOrm</a></li><li><a href="/berry-orm/en/guide/using-entity-manager.html" aria-current="page" class="active sidebar-link">Using EntityManager</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/using-entity-manager.html#populating-entities" class="sidebar-link">Populating Entities</a></li><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/using-entity-manager.html#population-state-of-entities" class="sidebar-link">Population State of Entities</a></li><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/using-entity-manager.html#populating-a-relation-field-separately" class="sidebar-link">Populating a Relation Field Separately</a></li><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/using-entity-manager.html#exporting-entities" class="sidebar-link">Exporting Entities</a></li></ul></li><li><a href="/berry-orm/en/guide/updating-entities.html" class="sidebar-link">Updating Entities</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/updating-entities.html#updating-data" class="sidebar-link">Updating Data</a></li><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/updating-entities.html#updating-relations" class="sidebar-link">Updating Relations</a></li></ul></li><li><a href="/berry-orm/en/guide/using-identity-map-manager.html" class="sidebar-link">Using IdentityMapManager</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/using-identity-map-manager.html#clearing-reference-store" class="sidebar-link">Clearing Reference Store</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Advanced</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/berry-orm/en/advanced/serializers.html" class="sidebar-link">Serializers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/berry-orm/en/advanced/serializers.html#using-serializers" class="sidebar-link">Using Serializers</a></li><li class="sidebar-sub-header"><a href="/berry-orm/en/advanced/serializers.html#creating-serializers" class="sidebar-link">Creating Serializers</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="using-entitymanager"><a href="#using-entitymanager" class="header-anchor">#</a> Using EntityManager</h1> <p>The <code>EntityManager</code> instance is provided on the <code>.em</code> property of <code>BerryOrm</code> instances. <code>EntityManager</code> is the most commonly used <code>Manager</code> for manipulating entities.</p> <h2 id="populating-entities"><a href="#populating-entities" class="header-anchor">#</a> Populating Entities</h2> <p><strong>The process of parsing the original data to update the data of the corresponding entity</strong> is called <strong><em>populating</em></strong>. Populating is one of the core features of Berry ORM.</p> <h3 id="populating-non-relation-fields"><a href="#populating-non-relation-fields" class="header-anchor">#</a> Populating non-relation fields</h3> <p>The original data used for populating <strong>must specify a value for each non-relation field</strong>.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> user <span class="token operator">=</span> orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">&quot;Charles&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code>user <span class="token keyword">instanceof</span> <span class="token class-name">User</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span>username <span class="token operator">==</span> <span class="token string">&quot;Charles&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="populating-relation-fields"><a href="#populating-relation-fields" class="header-anchor">#</a> Populating Relation Fields</h3> <p>Any <strong>relation field</strong> is optional in the original data, because usually the original data of one side of the relation does not specify all the relations, and some relations need to be specified in the original data on the other side.</p> <h4 id="populating-to-one-relation-fields"><a href="#populating-to-one-relation-fields" class="header-anchor">#</a> Populating To-One Relation Fields</h4> <p>A <strong>To-One Relation Field</strong> in the data can be represented as either a <strong>primary key</strong>:</p> <div class="language-ts extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-ts"><code><span class="token keyword">const</span> user <span class="token operator">=</span> orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">&quot;Charles&quot;</span><span class="token punctuation">,</span>
  profile<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>or a <strong>nested data object</strong>:</p> <div class="language-ts extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-ts"><code><span class="token keyword">const</span> user <span class="token operator">=</span> orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">&quot;Charles&quot;</span><span class="token punctuation">,</span>
  profile<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> nickname<span class="token operator">:</span> <span class="token string">&quot;Charlies&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If the inverse relation to the parent data object is specified in the nested data object, please ensure that they won't conflict, otherwise it may cause the wrong relations to be constructed.</p> <p>Here is a wrong example:</p> <div class="language-ts extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-ts"><code><span class="token keyword">const</span> user <span class="token operator">=</span> orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">&quot;Charles&quot;</span><span class="token punctuation">,</span>
  profile<span class="token operator">:</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    nickname<span class="token operator">:</span> <span class="token string">&quot;Charlies&quot;</span><span class="token punctuation">,</span>
    owner<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In this example, <code>user.profile</code> belongs to <code>user</code>, but <code>user.profile.owner</code> specifies that it belongs to another <code>User</code>, the relation conflicts. The correct approach is to specify <code>user.profile.owner</code> as a value that conforms to the existing relations, such as <code>1</code>; a better approach is to completely ignore <code>user.profile.owner</code> in the nested data, because the relation between them has already been determined, and there is no need to specify it repeatly.</p></div> <p>Berry ORM will construct a <strong>bilateral</strong> relation, which means you can access the other side from either side of the relation:</p> <div class="language-ts extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br></div><pre class="language-ts"><code>user<span class="token punctuation">.</span>profile <span class="token keyword">instanceof</span> <span class="token class-name">Profile</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner <span class="token operator">==</span> user<span class="token punctuation">;</span>
</code></pre></div><p><s>This also means that if you want, you can access the value like this:</s></p> <div class="language-ts extra-class"><pre class="language-ts"><code>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner
  <span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile
  <span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner
  <span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile
  <span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner
  <span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile
  <span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile
  <span class="token punctuation">.</span>nickname<span class="token punctuation">;</span>
</code></pre></div><h4 id="populating-to-many-relation-fields"><a href="#populating-to-many-relation-fields" class="header-anchor">#</a> Populating To-Many Relation Fields</h4> <p><strong>To-many relationship fields</strong> are represented in the data as an array <em>whose values are <strong>primary keys</strong> or <strong>nested data objects</strong></em>:</p> <div class="language-ts extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-ts"><code><span class="token keyword">const</span> department <span class="token operator">=</span> orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>Department<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">&quot;XXXXXX&quot;</span><span class="token punctuation">,</span>
  members<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> username<span class="token operator">:</span> <span class="token string">&quot;XDXDXDXD&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Similarly, if an inverse relation to the parent data object is specified in the nested data object, please ensure that they will not conflict.</p></div> <p>Berry ORM will construct a <strong>bilateral</strong> relation for them as well:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>department<span class="token punctuation">.</span>members<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  user<span class="token punctuation">.</span>department <span class="token operator">==</span> department<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="population-state-of-entities"><a href="#population-state-of-entities" class="header-anchor">#</a> Population State of Entities</h2> <p>You may have noticed that even though the entity represented by the primary key specified for the <strong>relation field</strong> in the data is not yet known:</p> <div class="language-ts extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-ts"><code><span class="token keyword">const</span> user <span class="token operator">=</span> orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">&quot;Charles&quot;</span><span class="token punctuation">,</span>
  profile<span class="token operator">:</span> <span class="token number">999999</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The following expressions still hold:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>user<span class="token punctuation">.</span>profile <span class="token keyword">instanceof</span> <span class="token class-name">Profile</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token number">999999</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner <span class="token operator">==</span> user<span class="token punctuation">;</span>
</code></pre></div><p>But if we take a closer look at <code>user.profile</code>, we will find that the value of any other field is empty (the value is <code>undefined</code> or an empty <code>Collection</code>):</p> <div class="language-ts extra-class"><pre class="language-ts"><code>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>bio <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>nickname <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
</code></pre></div><p>Such entities are in an <strong>unpopulated state</strong>. Any fields of entities in an <strong>unpopulated state</strong> are empty, <strong>except the primary key and a few relation fields</strong>. we can get the <strong>population state</strong> of the entity through its <code>[POPULATED]</code> property:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>user<span class="token punctuation">[</span><span class="token constant">POPULATED</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span>profile<span class="token punctuation">[</span><span class="token constant">POPULATED</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>POPULATED</code> is a <code>symbol</code>.</p></div> <p>The <strong>only way</strong> to mark an entity as <strong>populated</strong> is to invoke <code>orm.em.popuate()</code> to populate the entity:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">popuate</span><span class="token punctuation">(</span>Profile<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">999999</span><span class="token punctuation">,</span>
  nickname<span class="token operator">:</span> <span class="token string">&quot;Nickname&quot;</span><span class="token punctuation">,</span>
  bio<span class="token operator">:</span> <span class="token string">&quot;orz orz orz orz orz&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code>user<span class="token punctuation">.</span>profile<span class="token punctuation">[</span><span class="token constant">POPULATED</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="populating-a-relation-field-separately"><a href="#populating-a-relation-field-separately" class="header-anchor">#</a> Populating a Relation Field Separately</h2> <p><code>orm.em.populateRelationField()</code> will separately populate the specified relation field of the entity, the data type is the same as before. This <strong>will not</strong> change the <strong>population state</strong> of the entity.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">populateRelationField</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token string">&quot;friends&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>In most cases, you can <a href="/berry-orm/en/guide/updating-entities.html#updating-relations">update relations</a> directly through entity fields.</p></div> <h2 id="exporting-entities"><a href="#exporting-entities" class="header-anchor">#</a> Exporting Entities</h2> <p><code>.export()</code> allows you to <strong><em>export</em></strong> the data of an <strong>entity</strong> as an <strong>plain ordinary object</strong>. Exporting is another core feature of Berry ORM.</p> <h3 id="exporting-non-relation-fields"><a href="#exporting-non-relation-fields" class="header-anchor">#</a> Exporting Non-relation Fields</h3> <p>The value of the non-relation fields will be directly assigned to the data object.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> data <span class="token operator">=</span> orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code>data<span class="token punctuation">.</span>id <span class="token operator">==</span> user<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
data<span class="token punctuation">.</span>username <span class="token operator">==</span> user<span class="token punctuation">.</span>username<span class="token punctuation">;</span>
</code></pre></div><h3 id="exporting-relation-fields"><a href="#exporting-relation-fields" class="header-anchor">#</a> Exporting Relation Fields</h3> <p>Relations will be exported as primary keys by default:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> data <span class="token operator">=</span> orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">typeof</span> data<span class="token punctuation">.</span>profile <span class="token operator">==</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span>friends <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token builtin">Array</span></span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>friend<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> friend <span class="token operator">==</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can use the second parameter to control which relations need to be expanded (nesting is supported):</p> <div class="language-ts extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-ts"><code><span class="token keyword">const</span> data <span class="token operator">=</span> orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  profile<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  friends<span class="token operator">:</span> <span class="token punctuation">{</span> profile<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-ts extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-ts"><code><span class="token keyword">typeof</span> data<span class="token punctuation">.</span>profile <span class="token operator">==</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>friend<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">typeof</span> friend <span class="token operator">==</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">typeof</span> friend<span class="token punctuation">.</span>profile <span class="token operator">==</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The return type will be automatically updated based on the expanded relations.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If the relation entity you are trying to expand is in <a href="#population-state-of-entities">unpopulated state</a>, Berry ORM will throw an error.</p></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/TheNightmareX/berry-orm/edit/develop/docs/en/guide/using-entity-manager.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/5/2021, 12:53:49 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/berry-orm/en/guide/constructing-orm.html" class="prev">
        Constructing BerryOrm
      </a></span> <span class="next"><a href="/berry-orm/en/guide/updating-entities.html">
        Updating Entities
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/berry-orm/assets/js/app.bfa13add.js" defer></script><script src="/berry-orm/assets/js/2.e602c081.js" defer></script><script src="/berry-orm/assets/js/12.82d3c7ed.js" defer></script>
  </body>
</html>
