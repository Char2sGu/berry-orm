<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using EntityManager | Berry ORM</title>
    <meta name="generator" content="VuePress 1.8.2">
    <meta name="description" content="Object Relational Mapping for front-ends">
    <link rel="preload" href="/berry-orm/assets/css/0.styles.69ca23ae.css" as="style"><link rel="preload" href="/berry-orm/assets/js/app.95acb086.js" as="script"><link rel="preload" href="/berry-orm/assets/js/2.e602c081.js" as="script"><link rel="preload" href="/berry-orm/assets/js/12.5a180a4c.js" as="script"><link rel="prefetch" href="/berry-orm/assets/js/10.2206ee2a.js"><link rel="prefetch" href="/berry-orm/assets/js/11.d48222c9.js"><link rel="prefetch" href="/berry-orm/assets/js/13.94be1097.js"><link rel="prefetch" href="/berry-orm/assets/js/14.d0b24320.js"><link rel="prefetch" href="/berry-orm/assets/js/15.6df932e2.js"><link rel="prefetch" href="/berry-orm/assets/js/16.98311964.js"><link rel="prefetch" href="/berry-orm/assets/js/17.e35c8155.js"><link rel="prefetch" href="/berry-orm/assets/js/18.334450c3.js"><link rel="prefetch" href="/berry-orm/assets/js/19.0c99a08e.js"><link rel="prefetch" href="/berry-orm/assets/js/20.52f6cdb3.js"><link rel="prefetch" href="/berry-orm/assets/js/3.17507fd5.js"><link rel="prefetch" href="/berry-orm/assets/js/4.8c15e02b.js"><link rel="prefetch" href="/berry-orm/assets/js/5.d250c593.js"><link rel="prefetch" href="/berry-orm/assets/js/6.740329d2.js"><link rel="prefetch" href="/berry-orm/assets/js/7.b985afee.js"><link rel="prefetch" href="/berry-orm/assets/js/8.a6fac172.js"><link rel="prefetch" href="/berry-orm/assets/js/9.1bc08fb8.js">
    <link rel="stylesheet" href="/berry-orm/assets/css/0.styles.69ca23ae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/berry-orm/en/" class="home-link router-link-active"><!----> <span class="site-name">Berry ORM</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/berry-orm/en/guide/using-entity-manager.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/berry-orm/zh/guide/using-entity-manager.html" class="nav-link">
  zh-CN
</a></li></ul></div></div> <a href="https://github.com/TheNightmareX/berry-orm" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/berry-orm/en/guide/using-entity-manager.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/berry-orm/zh/guide/using-entity-manager.html" class="nav-link">
  zh-CN
</a></li></ul></div></div> <a href="https://github.com/TheNightmareX/berry-orm" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/berry-orm/en/guide/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/berry-orm/en/guide/defining-entities.html" class="sidebar-link">Defining Entities</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/defining-entities.html#defining-entity-classes" class="sidebar-link">Defining Entity Classes</a></li><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/defining-entities.html#defining-entity-fields" class="sidebar-link">Defining Entity Fields</a></li><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/defining-entities.html#completing-type-support" class="sidebar-link">Completing Type Support</a></li></ul></li><li><a href="/berry-orm/en/guide/constructing-orm.html" class="sidebar-link">Constructing BerryOrm</a></li><li><a href="/berry-orm/en/guide/using-entity-manager.html" aria-current="page" class="active sidebar-link">Using EntityManager</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/using-entity-manager.html#populating-entities" class="sidebar-link">Populating Entities</a></li><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/using-entity-manager.html#population-state-of-entities" class="sidebar-link">Population State of Entities</a></li><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/using-entity-manager.html#retriving-entities" class="sidebar-link">Retriving Entities</a></li><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/using-entity-manager.html#clearing-the-internal-store" class="sidebar-link">Clearing the Internal Store</a></li><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/using-entity-manager.html#populating-a-relation-field-separately" class="sidebar-link">Populating a Relation Field Separately</a></li></ul></li><li><a href="/berry-orm/en/guide/updating-entities.html" class="sidebar-link">Updating Entities</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/updating-entities.html#updating-data" class="sidebar-link">Updating Data</a></li><li class="sidebar-sub-header"><a href="/berry-orm/en/guide/updating-entities.html#updating-relations" class="sidebar-link">Updating Relations</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Advanced</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/berry-orm/en/advanced/custom-store.html" class="sidebar-link">Custom Store</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="using-entitymanager"><a href="#using-entitymanager" class="header-anchor">#</a> Using EntityManager</h1> <h2 id="populating-entities"><a href="#populating-entities" class="header-anchor">#</a> Populating Entities</h2> <p>The process of <strong>resolving data and assigning values to the fields of the corresponding entities</strong> is called <strong>populating</strong>. <strong>Populating</strong> is the core feature of Berry ORM.</p> <h3 id="populating-the-primary-key-and-data"><a href="#populating-the-primary-key-and-data" class="header-anchor">#</a> Populating the Primary Key and Data</h3> <p>The data used for <strong>populating</strong> must specify values of the <strong>primary key field</strong> and all the <strong>data fields</strong> of the entity.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> user <span class="token operator">=</span> orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">&quot;Charles&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code>user <span class="token keyword">instanceof</span> <span class="token class-name">User</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
user<span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
user<span class="token punctuation">.</span>username <span class="token operator">==</span> <span class="token string">&quot;Charles&quot;</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><h3 id="populating-relations"><a href="#populating-relations" class="header-anchor">#</a> Populating Relations</h3> <p>If the value of the entity's <strong>relation fields</strong> are provided, Berry ORM will resolve these values and construct relations on the corresponding fields of both the two entities.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The type of the <strong>data</strong> used for populating is tailored for the return value of the back-end APIs, any <strong>relation fields</strong> are optional in <strong>data</strong>.</p></div> <h4 id="populating-to-one-relation-fields"><a href="#populating-to-one-relation-fields" class="header-anchor">#</a> Populating To-One Relation Fields</h4> <p><strong>对单关系字段</strong>在数据中的表现形式既可以是一个<strong>主键</strong>：
A <strong>To-One Relation Field</strong> in the data can be represented as either a <strong>primary key</strong>:</p> <div class="language-ts extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-ts"><code><span class="token keyword">const</span> user <span class="token operator">=</span> orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">&quot;Charles&quot;</span><span class="token punctuation">,</span>
  profile<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>or a <strong>nested data object</strong>:</p> <div class="language-ts extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-ts"><code><span class="token keyword">const</span> user <span class="token operator">=</span> orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">&quot;Charles&quot;</span><span class="token punctuation">,</span>
  profile<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> nickname<span class="token operator">:</span> <span class="token string">&quot;王大锤&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If the inverse relation to the parent data object is specified in the nested data object, please ensure that they won't conflict, otherwise it may cause the wrong relations to be constructed. For example:</p> <div class="language-ts extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-ts"><code><span class="token keyword">const</span> user <span class="token operator">=</span> orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">&quot;Charles&quot;</span><span class="token punctuation">,</span>
  profile<span class="token operator">:</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    nickname<span class="token operator">:</span> <span class="token string">&quot;Nickname&quot;</span><span class="token punctuation">,</span>
    owner<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In this example, if <code>profile.owner</code> is specified, the value must match the existing relations. In the existing relations, the <code>Profile</code> belongs to this <code>User</code>, but another <code>User</code> is specified as its owner in the data of the <code>Profile</code>. The relations conflict. To solve this, <code>profile.owner</code> should be specified as a value that conforms to the existing relations, such as: <code>1</code>; it is better to ignore <code>profile.owner</code> in the nested data directly, because the relation between the two has already been determined and there is no need to specify it repeatly.</p></div> <p>Berry ORM will construct <strong>bilateral</strong> relations:</p> <div class="language-ts extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br></div><pre class="language-ts"><code>user<span class="token punctuation">.</span>profile <span class="token keyword">instanceof</span> <span class="token class-name">Profile</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner <span class="token operator">==</span> user<span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>This also means that if you want, you can access the value like this:<br>
XD</p> <div class="language-ts extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br></div><pre class="language-ts"><code>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>nickname<span class="token punctuation">;</span> <span class="token comment">// Nickname</span>
</code></pre></div><h4 id="populating-to-many-relation-fields"><a href="#populating-to-many-relation-fields" class="header-anchor">#</a> Populating To-Many Relation Fields</h4> <p><strong>To-many relationship fields</strong> are represented in the data as an array <em>whose values are <strong>primary keys</strong> or <strong>nested data objects</strong></em>:</p> <div class="language-ts extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-ts"><code><span class="token keyword">const</span> department <span class="token operator">=</span> orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>Department<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">&quot;XXXXXX&quot;</span><span class="token punctuation">,</span>
  members<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> username<span class="token operator">:</span> <span class="token string">&quot;XDXDXDXD&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Similarly, if an inverse relation to the parent data object is specified in the nested data object, please ensure that they will not conflict.</p></div> <p>Also, a <strong>bilateral</strong> relation will be constructed:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>department<span class="token punctuation">.</span>members<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  user<span class="token punctuation">.</span>department <span class="token operator">==</span> department<span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="population-state-of-entities"><a href="#population-state-of-entities" class="header-anchor">#</a> Population State of Entities</h2> <p>You may have noticed that even though the entity represented by the primary key specified for the <strong>relation field</strong> in the data is not yet known:</p> <div class="language-ts extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-ts"><code><span class="token keyword">const</span> user <span class="token operator">=</span> orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">&quot;Charles&quot;</span><span class="token punctuation">,</span>
  profile<span class="token operator">:</span> <span class="token number">999999</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The following expressions still hold:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>user<span class="token punctuation">.</span>profile <span class="token keyword">instanceof</span> <span class="token class-name">Profile</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token number">999999</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>owner <span class="token operator">==</span> user<span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>But if we take a closer look at <code>user.profile</code>, we will find that the value of any other field is empty (the value is <code>undefined</code> or an empty <code>Collection</code>):</p> <div class="language-ts extra-class"><pre class="language-ts"><code>user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>bio <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
user<span class="token punctuation">.</span>profile<span class="token punctuation">.</span>nickname <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>Such an entity is in the <strong>unpopulated state</strong>, we can get the population state of the entity through the <code>[POPULATED]</code> property of the entity:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>user<span class="token punctuation">[</span><span class="token constant">POPULATED</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
user<span class="token punctuation">.</span>profile<span class="token punctuation">[</span><span class="token constant">POPULATED</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>POPULATED</code> is a <code>symbol</code>.</p></div> <p>The only way to mark an entity as <strong>populated</strong> is to invoke <code>orm.em.popuate()</code> to populate the entity:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">popuate</span><span class="token punctuation">(</span>Profile<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">999999</span><span class="token punctuation">,</span>
  nickname<span class="token operator">:</span> <span class="token string">&quot;Nickname&quot;</span><span class="token punctuation">,</span>
  bio<span class="token operator">:</span> <span class="token string">&quot;orz orz orz orz orz&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code>user<span class="token punctuation">.</span>profile<span class="token punctuation">[</span><span class="token constant">POPULATED</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><h2 id="retriving-entities"><a href="#retriving-entities" class="header-anchor">#</a> Retriving Entities</h2> <p><code>orm.em.retrieve()</code> will return an entity with the specified primary key, but the entity may be either <strong>populated</strong> or <strong>unpopulated</strong>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Berry ORM is a library that focuses on only Object Relational Mapping. Please store the entities in a place that you manage. Don't dependent on the internal store of Berry ORM. <code>orm.em.retrieve()</code> should be rarely used.</p></div> <div class="language-ts extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br></div><pre class="language-ts"><code><span class="token keyword">const</span> user <span class="token operator">=</span> orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token number">12345678</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user <span class="token keyword">instanceof</span> <span class="token class-name">User</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
user<span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token number">12345678</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
user<span class="token punctuation">[</span><span class="token constant">POPULATED</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre></div><p>For the same parameters, <code>orm.em.retrieve()</code> will always return a same reference.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token number">987654</span><span class="token punctuation">)</span> <span class="token operator">==</span> orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> <span class="token number">987654</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><h2 id="clearing-the-internal-store"><a href="#clearing-the-internal-store" class="header-anchor">#</a> Clearing the Internal Store</h2> <p>When encountering a situation like a user logged out, we may need to clear the internal store to ensure that the user-specific data will not be leaked unexpectedly.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The previous entities will not be affected, but the future <strong>populating</strong> operations will no longer refer to the previous entities, but will create a new <strong>unpopulated</strong> entity.</p> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>Please be sure to clear the entity stores you manage too to completely remove all the previous entities, otherwise, it can easily lead to confusing and unexpected behaviors.</p></div> <h2 id="populating-a-relation-field-separately"><a href="#populating-a-relation-field-separately" class="header-anchor">#</a> Populating a Relation Field Separately</h2> <p><code>orm.em.populateRelationField()</code> will separately populate the specified relation field of the entity, the data type is the same as before. This <strong>will not</strong> change the <strong>population state</strong> of the entity.</p> <div class="language-ts extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br></div><pre class="language-ts"><code>user<span class="token punctuation">.</span>department<span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
orm<span class="token punctuation">.</span>em<span class="token punctuation">.</span><span class="token function">populateRelationField</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token string">&quot;department&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span>department<span class="token punctuation">.</span>id <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Try to avoid populating relation fields separately. If you want to update the relation, please directly <a href="/berry-orm/en/guide/updating-entities.html#updating-relations">update the relations</a> through the entity.</p></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/TheNightmareX/berry-orm/edit/develop/docs/en/guide/using-entity-manager.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/21/2021, 2:10:23 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/berry-orm/en/guide/constructing-orm.html" class="prev">
        Constructing BerryOrm
      </a></span> <span class="next"><a href="/berry-orm/en/guide/updating-entities.html">
        Updating Entities
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/berry-orm/assets/js/app.95acb086.js" defer></script><script src="/berry-orm/assets/js/2.e602c081.js" defer></script><script src="/berry-orm/assets/js/12.5a180a4c.js" defer></script>
  </body>
</html>
